> ⚙️ **Template Notice:**  
> This file is an official Docs-as-System template.  
> Do not edit it directly inside the project. When initializing a new system, copy it into a folder named `docs/`  
> and save it as `AGENT_OPERATIONAL_POLICY.md`, adapting it to the organization.

# Agent Operational Policy — Template

**File in the actual project:** `docs/agent/AGENT_OPERATIONAL_POLICY.md`  
**Template in the templates folder:** `templates/agent/AGENT_OPERATIONAL_POLICY_TEMPLATE.md`  
**Related configuration file:** `docs/agent/AGENT_CONFIG.yaml`  
**Creator:** Human, according to organizational policy  
**Approver:** Chief Architect / Security Lead / Tech Lead  
**Document Type:** Operational Policy  

**Purpose**  
Define the operational, control, security, and documentation guidelines for the AI agent working in the project.  
The policy ensures that every agent action is traceable, human-reviewed, and fully documented.

---

## Core Principles

1. The agent operates only according to approved project documents:  
   `PROJECT_SPEC.md`, `ARCHITECTURE_BLUEPRINT.md`, `PLAN.md`.  
   In the template folder these appear as `*_TEMPLATE.md`.
2. Every agent change is recorded in the implementation log:  
   `docs/logs/IMPLEMENTATION_LOG.md`.
3. The agent does not write to protected branches such as `main` or `release/*`.  
   It operates only in dedicated branches under `agent/*`.
4. Every output undergoes human Review and Approval before merging.
5. In any case of conflict between documents or uncertainty,  
   the agent pauses and requests explicit instructions.

---

## Daily Operational Policy

| Area | Principles |
|------|------------|
| Code Writing | Definition-based, consistent naming, readable code only. |
| Documentation | Any code change requires updating the relevant document. |
| Git | Small commits with clear titles and descriptions including a reference to the source document. |
| Tests | Self-Check before any Commit or Pull Request. |
| Errors | Logged with status; execution is paused until human guidance is given. |

---

### Operational Principles

- **No secrets, passwords, or access tokens in visible code.**  
  Use environment variables or secure configuration files only.

- **Input Validation:**  
  Any code created or modified by the agent must validate inputs before processing.

- **Injection Safety:**  
  All database access or command execution must use parameters, never raw string concatenation.

- **Least Privilege:**  
  Generated code must assume minimal permissions rather than admin-level access.

- **Privacy Preservation:**  
  Logs and documents must not include personal data, passwords, or tokens.  
  Sensitive data must be masked or encrypted when necessary.

- **Security Documentation:**  
  Any security-related change is recorded in  
  `docs/logs/IMPLEMENTATION_LOG.md` with the tag `SECURITY_CHANGE`.

- **Self-Security Checks:**  
  Before every commit, the agent verifies:  
  - No uncontrolled external calls  
  - No direct writes to unapproved external files  
  - No sensitive fields or secrets appear in code  

---

## Security and Secure Coding

- Validate inputs and encode outputs according to context (Web, CLI, DB).  
- Operate strictly with minimal privileges (Least Privilege).  
- Secrets must be stored only in a Secret Store or environment variables.  
- Logs must remain free of sensitive data; mask or trim values if needed.  
- New code is checked against known libraries to avoid vulnerable dependencies.  
- Dependency scanners and SBOM generation run as part of Self-Validation.  
- Every security deviation is logged with a concise reason and solution.

---

## Recommended Commit Structure

Short title, focused description, and reference to the originating document or task.
```
feat(billing): add idempotency check in BillingConsumer

Refs: docs/PROJECT_SPEC.md §3.4, docs/PLAN.md #Task-12
AI-Generated: true
Human-Approved: true
Validated: true
```

---

## Documentation Policy

- Every change is logged in `docs/logs/IMPLEMENTATION_LOG.md`  
  with timestamp, commit ID, and short description.  
- Updating an existing document must preserve consistent headings and links.  
- New files must include a source note:  
  `"Generated by AI agent according to human instructions on …"`.

---

## Self-Validation Before Commit or PR

Before any Commit or Pull Request, the agent performs:

1. Code compilation or linting.  
2. Relevant Unit Tests.  
3. Markdown linting for modified documents.  
4. Link Checker for all document references.  
5. Consistency check between code and documents (`Spec`, `Blueprint`).  
6. Verification of Git Trailers in the commit.  
7. Security checks:  
   - No secrets  
   - Dependencies scanned  
   - No unsafe calls  

If any check fails, a log entry is created with `VALIDATION_FAILED`,  
and no code is pushed forward.

---

## Handling Exceptions

- If the agent encounters an error in code, Git, or instructions,  
  it marks the action as `PENDING_REVIEW` and logs an explanation.  
- Repeated issues trigger a Self-Diagnosis report including root-cause analysis.  
- The agent resumes only after human approval.

---

## Cross-Document Consistency

| Relationship | What is Verified |
|--------------|------------------|
| Business → Project Spec | Business requirements appear in the Spec. |
| Project Spec → Blueprint | Architecture reflects and implements the Spec. |
| Blueprint → Implementation Log | Every code change is logged according to the planned design. |
| Compliance / Agent Policy | Policies remain aligned with all other documents. |

---

## Integration with BY_CYCLE Logging

- Every agent action is logged in `docs/logs/IMPLEMENTATION_LOG.md`.  
- At the end of each work cycle, a summary is generated using:  
  `templates/logs/IMPLEMENTATION_LOG_SUMMARY_BY_CYCLE_TEMPLATE.he.md`.  
- Each log entry must include:  
  - `CycleId`  
  - `When`  
  - `Actor` (Agent/Human)  
  - `Scope` (files or modules)  
  - `SpecRef`  
  - `Result` (Success/Failed/Pending)  
  - `SecurityChange` (Yes/No)  
  - `PR`  

---

## Typical Workflow

1. Human approves a new item in `docs/project/PROJECT_SPEC.md`.  
2. Agent generates code, updates the Blueprint, and opens a new branch under `agent/...`.  
3. Agent logs the activity entry.  
4. Human performs Review and merges into `feature/*`, or opens a PR to `main`.  
5. After successful validations, mark as `Validated`.

---

## Summary

This policy defines the boundaries of responsibility between humans and the agent.  
It ensures a documented, controlled, secure, and fully auditable workflow.  
This preserves the balance between automated efficiency and real human oversight.

---

>© 2025 Tomer Kedem. Part of the official **Docs-as-System** template suite.
